version: '3'

tasks:
  setup-cluster:
    desc: "Utw√≥rz klaster Kubernetes u≈ºywajƒÖc kind"
    cmds:
      - kind create cluster --name observability
      - kubectl config use-context kind-observability
      - echo "‚úÖ Klaster Kubernetes utworzony"

  delete-cluster:
    desc: "Usu≈Ñ klaster kind"
    cmds:
      - kind delete cluster --name observability
      - echo "‚úÖ Klaster Kubernetes usuniƒôty"

  create-namespace:
    desc: "Utw√≥rz przestrze≈Ñ nazw monitoring"
    cmds:
      - kubectl apply -f k8s/namespaces/monitoring.yaml
      - echo "‚úÖ Namespace 'monitoring' utworzony"

  apply-prometheus:
    desc: "Wdr√≥≈º Prometheus"
    cmds:
      - kubectl apply -f k8s/prometheus/
      - echo "‚úÖ Prometheus wdro≈ºony"

  apply-grafana:
    desc: "Wdr√≥≈º Grafana"
    cmds:
      - kubectl apply -f k8s/grafana/
      - echo "‚úÖ Grafana wdro≈ºona"

  apply-loki:
    desc: "Wdr√≥≈º Loki"
    cmds:
      - kubectl apply -f k8s/loki/
      - echo "‚úÖ Loki wdro≈ºony"

  apply-promtail:
    desc: "Wdr√≥≈º Promtail"
    cmds:
      - kubectl apply -f k8s/promtail/
      - echo "‚úÖ Promtail wdro≈ºony"

  apply-jaeger:
    desc: "Wdr√≥≈º Jaeger"
    cmds:
      - kubectl apply -f k8s/jaeger/
      - echo "‚úÖ Jaeger wdro≈ºony"

  apply-monitoring:
    desc: "Wdr√≥≈º ca≈Çy stos monitorujƒÖcy"
    cmds:
      - task: create-namespace
      - task: apply-prometheus
      - task: apply-grafana
      - task: apply-loki
      - task: apply-promtail
      - task: apply-jaeger
      - echo "üöÄ Wszystkie komponenty monitorujƒÖce wdro≈ºone!"

  port-forward:
    desc: "Uruchom skrypt do przekierowania wszystkich port√≥w"
    cmds:
      - bash scripts/port-forward.sh

  status:
    desc: "Sprawd≈∫ status komponent√≥w monitorujƒÖcych"
    cmds:
      - |
        echo "Sprawdzanie pod√≥w w przestrzeni nazw monitoring..."
        kubectl get pods -n monitoring
        echo ""
        echo "Sprawdzanie us≈Çug w przestrzeni nazw monitoring..."
        kubectl get svc -n monitoring

  deploy-all:
    desc: "Wdr√≥≈º wszystko - klaster, monitoring"
    cmds:
      - task: setup-cluster
      - task: apply-monitoring
      - task: status
      - |
        echo ""
        echo "üéâ Observability Stack wdro≈ºony pomy≈õlnie!"
        echo ""
        echo "Aby uzyskaƒá dostƒôp do interfejs√≥w UI, uruchom:"
        echo "  task port-forward"
        echo ""
        echo "Dostƒôpne interfejsy webowe:"
        echo "  - Prometheus: http://localhost:9090"
        echo "  - Grafana:    http://localhost:3000 (admin/admin)"
        echo "  - Jaeger UI:  http://localhost:16686"
        echo "  - Loki API:   http://localhost:3100"

  reset:
    desc: "Reset ca≈Çego ≈õrodowiska"
    cmds:
      - task: delete-cluster
      - task: deploy-all

  urls:
    desc: "Poka≈º URL do wszystkich interfejs√≥w"
    cmds:
      - |
        echo "Dostƒôpne interfejsy webowe:"
        echo "  - Prometheus: http://localhost:9090"
        echo "  - Grafana:    http://localhost:3000 (admin/admin)"
        echo "  - Jaeger UI:  http://localhost:16686"
        echo "  - Loki API:   http://localhost:3100"